#include <stdlib.h>
#include <string.h>
#include "..\config.h"
#include "transplant.h"
#include "main.h"


const int16 SIN_TABLE[]=
{
0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,
15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,
31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,
47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,
63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,
79,80,81,82,83,84,85,86,87,88,89,90,91,92,92,93,
94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,
110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,
126,127,128,129,130,131,132,132,133,134,135,136,137,138,139,140,
141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,
156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,
172,173,173,174,175,176,177,178,179,180,181,182,183,184,185,186,
187,188,188,189,190,191,192,193,194,195,196,197,198,199,200,200,
201,202,203,204,205,206,207,208,209,210,211,211,212,213,214,215,
216,217,218,219,220,221,221,222,223,224,225,226,227,228,229,230,
230,231,232,233,234,235,236,237,238,238,239,240,241,242,243,244,
245,245,246,247,248,249,250,251,252,252,253,254,255,256,257,258,
259,259,260,261,262,263,264,265,265,266,267,268,269,270,271,271,
272,273,274,275,276,276,277,278,279,280,281,281,282,283,284,285,
286,286,287,288,289,290,291,291,292,293,294,295,296,296,297,298,
299,300,300,301,302,303,304,304,305,306,307,308,308,309,310,311,
312,312,313,314,315,316,316,317,318,319,319,320,321,322,323,323,
324,325,326,326,327,328,329,330,330,331,332,333,333,334,335,336,
336,337,338,339,339,340,341,342,342,343,344,345,345,346,347,348,
348,349,350,350,351,352,353,353,354,355,356,356,357,358,358,359,
360,361,361,362,363,363,364,365,365,366,367,368,368,369,370,370,
371,372,372,373,374,374,375,376,376,377,378,379,379,380,381,381,
382,383,383,384,385,385,386,386,387,388,388,389,390,390,391,392,
392,393,394,394,395,396,396,397,397,398,399,399,400,401,401,402,
402,403,404,404,405,405,406,407,407,408,409,409,410,410,411,412,
412,413,413,414,414,415,416,416,417,417,418,419,419,420,420,421,
421,422,423,423,424,424,425,425,426,426,427,428,428,429,429,430,
430,431,431,432,432,433,434,434,435,435,436,436,437,437,438,438,
439,439,440,440,441,441,442,442,443,443,444,444,445,445,446,446,
447,447,448,448,449,449,450,450,451,451,452,452,453,453,453,454,
454,455,455,456,456,457,457,458,458,458,459,459,460,460,461,461,
462,462,462,463,463,464,464,465,465,465,466,466,467,467,467,468,
468,469,469,469,470,470,471,471,471,472,472,473,473,473,474,474,
474,475,475,476,476,476,477,477,477,478,478,478,479,479,480,480,
480,481,481,481,482,482,482,483,483,483,484,484,484,485,485,485,
486,486,486,487,487,487,487,488,488,488,489,489,489,490,490,490,
490,491,491,491,492,492,492,492,493,493,493,493,494,494,494,495,
495,495,495,496,496,496,496,497,497,497,497,497,498,498,498,498,
499,499,499,499,500,500,500,500,500,501,501,501,501,501,502,502,
502,502,502,503,503,503,503,503,504,504,504,504,504,504,505,505,
505,505,505,505,506,506,506,506,506,506,506,507,507,507,507,507,
507,507,508,508,508,508,508,508,508,508,509,509,509,509,509,509,
509,509,509,510,510,510,510,510,510,510,510,510,510,510,510,511,
511,511,511,511,511,511,511,511,511,511,511,511,511,511,511,512,
512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,
512,512,512,512,512,512
};

const int16 ASIN_TABLE[]=
{
0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,
15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,
31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,
47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,
63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,
79,80,81,82,83,84,85,86,87,88,89,90,91,93,94,95,
96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,
112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,
128,129,130,131,132,134,135,136,137,138,139,140,141,142,143,144,
145,146,147,148,149,150,151,152,153,154,155,156,157,159,160,161,
162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,178,
179,180,181,182,183,184,185,186,187,188,189,190,191,193,194,195,
196,197,198,199,200,201,202,203,204,205,207,208,209,210,211,212,
213,214,215,216,217,219,220,221,222,223,224,225,226,227,229,230,
231,232,233,234,235,236,237,239,240,241,242,243,244,245,246,248,
249,250,251,252,253,254,255,257,258,259,260,261,262,263,265,266,
267,268,269,270,272,273,274,275,276,277,279,280,281,282,283,284,
286,287,288,289,290,291,293,294,295,296,297,299,300,301,302,303,
305,306,307,308,310,311,312,313,314,316,317,318,319,321,322,323,
324,325,327,328,329,330,332,333,334,335,337,338,339,341,342,343,
344,346,347,348,350,351,352,353,355,356,357,359,360,361,363,364,
365,367,368,369,370,372,373,375,376,377,379,380,381,383,384,385,
387,388,389,391,392,394,395,396,398,399,401,402,403,405,406,408,
409,411,412,414,415,416,418,419,421,422,424,425,427,428,430,431,
433,434,436,437,439,440,442,443,445,446,448,450,451,453,454,456,
457,459,461,462,464,466,467,469,470,472,474,475,477,479,480,482,
484,486,487,489,491,493,494,496,498,500,501,503,505,507,509,510,
512,514,516,518,520,522,524,526,527,529,531,533,535,537,539,541,
543,546,548,550,552,554,556,558,560,563,565,567,569,571,574,576,
578,581,583,586,588,590,593,595,598,601,603,606,608,611,614,617,
619,622,625,628,631,634,637,640,644,647,650,654,657,661,664,668,
672,676,680,684,689,693,698,703,708,714,719,726,733,740,749,759,
772,804
};

int16 SQRT16(Uint32 M)
{
	Uint32 N;
	Uint32 tmp,ttp;
	Uint16 i;
	
	if(M==0)
		return 0;
	ttp=0;
	N=0;
	tmp=(M>>30);
	M<<=2;
	if(tmp>1)
	{
		N++;
		tmp-=N;
	}
	for(i=15;i>0;i--)
	{
		N<<=1;
		tmp<<=2;
		tmp+=(M>>30);
		ttp=N;
		ttp=(ttp<<1)+1;
		
		M<<=2;
		if(tmp>=ttp)
		{
			tmp-=ttp;
			N++;
		}
	}
	return (int16)(N+1);
}

int16 SIN(int16 a)
{
	if(a<0)
		return (a<-PI/2?-SIN_TABLE[PI+a]:-SIN_TABLE[-a]);
	else
		return (a>PI/2?SIN_TABLE[PI-a]:SIN_TABLE[a]);
}

int16 COS(int16 a)
{
	if(a<0)
		return (a<-PI/2?-SIN_TABLE[-a-PI/2]:SIN_TABLE[a+PI/2]);
	else
		return (a>PI/2?-SIN_TABLE[a-PI/2]:SIN_TABLE[PI/2-a]);
}

int16 ARCTAN2(int16 y,int16 x)
{
	int32 ret=0;
	if(x==0)
	{
		if(y==0)
			return -1;
		else
			ret=PI/2; 
	}else
	{
		/*
		ret=(int32)y*y;
		ret=(ret<<(30-LENGTH_BIT_LIMIT*2));
		ret=ret/((int32)x*x+(int32)y*y);
		ret=SQRT16(ret);
		ret<<=(PRECISION_BIT+LENGTH_BIT_LIMIT-15);
		ret=ASIN_TABLE[ret];
		*/
		ret=(int32)y*y;
		ret=(ret<<(PRECISION_BIT+1));
		ret=(1<<PRECISION_BIT)-ret/((int32)x*x+(int32)y*y);
		ret=((ARCCOS(ret))>>1);
	}
	if(y<0)
	{
		if(x<0)
			ret=ret-PI;
		else
			ret=-ret;
	}else
	{
		if(x<0)
			ret=PI-ret;
		else
			ret=ret;
	}
	return (int16)ret;
}



